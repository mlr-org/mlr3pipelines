<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Wrap a Learner into a PipeOp with Cross-validated Predictions as Features — mlr_pipeops_learner_cv • mlr3pipelines</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Wrap a Learner into a PipeOp with Cross-validated Predictions as Features — mlr_pipeops_learner_cv" />
<meta property="og:description" content="Wraps an mlr3::Learner into a PipeOp.
Returns cross-validated predictions during training as a Task and stores a model of the
Learner trained on the whole data in $state. This is used to create a similar
Task during prediction.
The Task gets features depending on the capsuled Learner's
$predict_type. If the Learner's $predict.type is &quot;response&quot;, a feature &amp;lt;ID&amp;gt;.response is created,
for $predict.type &quot;prob&quot; the &amp;lt;ID&amp;gt;.prob.&amp;lt;CLASS&amp;gt; features are created, and for $predict.type &quot;se&quot; the new columns
are &amp;lt;ID&amp;gt;.response and &amp;lt;ID&amp;gt;.se. &amp;lt;ID&amp;gt; denotes the $id of the PipeOpLearnerCV object.
Inherits the $param_set (and therefore $param_set$values) from the Learner it is constructed from.
PipeOpLearnerCV can be used to create &quot;stacking&quot; or &quot;super learning&quot; Graphs that use the output of one Learner
as feature for another Learner. Because the PipeOpLearnerCV erases the original input features, it is often
useful to use PipeOpFeatureUnion to bind the prediction Task to the original input Task." />
<meta property="og:image" content="https://mlr3pipelines.mlr-org.com/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://mlr-org.com"><img src="https://raw.githubusercontent.com/mlr-org/mlr3/master/man/figures/logo.png" id="hexlogo" alt="mlr-org" /></a>
        <a class="navbar-brand" href="../index.html">mlr3pipelines <small>v0.3.7</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">
    <span class="fa fa-file-alt"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://mlr3book.mlr-org.com">
    <span class="fa fa-link"></span>
     
    mlr3book
  </a>
</li>
        <li>
  <a href="https://github.com/mlr-org/mlr3pipelines/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa-comments"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Wrap a Learner into a PipeOp with Cross-validated Predictions as Features</h1>
    <small class="dont-index">Source: <a href='https://github.com/mlr-org/mlr3pipelines/blob/master/R/PipeOpLearnerCV.R'><code>R/PipeOpLearnerCV.R</code></a></small>
    <div class="hidden name"><code>mlr_pipeops_learner_cv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Wraps an <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>mlr3::Learner</a></code> into a <code><a href='PipeOp.html'>PipeOp</a></code>.</p>
<p>Returns cross-validated predictions during training as a <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> and stores a model of the
<code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> trained on the whole data in <code>$state</code>. This is used to create a similar
<code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> during prediction.</p>
<p>The <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> gets features depending on the capsuled <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>'s
<code>$predict_type</code>. If the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>'s <code>$predict.type</code> is <code>"response"</code>, a feature <code>&lt;ID&gt;.response</code> is created,
for <code>$predict.type</code> <code>"prob"</code> the <code>&lt;ID&gt;.prob.&lt;CLASS&gt;</code> features are created, and for <code>$predict.type</code> <code>"se"</code> the new columns
are <code>&lt;ID&gt;.response</code> and <code>&lt;ID&gt;.se</code>. <code>&lt;ID&gt;</code> denotes the <code>$id</code> of the <code>PipeOpLearnerCV</code> object.</p>
<p>Inherits the <code>$param_set</code> (and therefore <code>$param_set$values</code>) from the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> it is constructed from.</p>
<p><code>PipeOpLearnerCV</code> can be used to create "stacking" or "super learning" <code><a href='Graph.html'>Graph</a></code>s that use the output of one <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>
as feature for another <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>. Because the <code>PipeOpLearnerCV</code> erases the original input features, it is often
useful to use <code><a href='mlr_pipeops_featureunion.html'>PipeOpFeatureUnion</a></code> to bind the prediction <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> to the original input <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code>.</p>
    </div>



    <h2 class="hasAnchor" id="format"><a class="anchor" href="#format"></a>Format</h2>

    <p><code>R6Class</code> object inheriting from <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>/<code><a href='PipeOp.html'>PipeOp</a></code>.</p>
    <h2 class="hasAnchor" id="construction"><a class="anchor" href="#construction"></a>Construction</h2>

    
<pre><span class='va'>PipeOpLearnerCV</span><span class='op'>$</span><span class='fu'>new</span><span class='op'>(</span><span class='va'>learner</span>, id <span class='op'>=</span> <span class='cn'>NULL</span>, param_vals <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</pre>
<ul>
<li><p><code>learner</code> :: <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> <br />
<code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> to use for cross validation / prediction, or a string identifying a
<code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> in the <code><a href='https://mlr3.mlr-org.com/reference/mlr_learners.html'>mlr3::mlr_learners</a></code> <code><a href='https://mlr3misc.mlr-org.com/reference/Dictionary.html'>Dictionary</a></code>.
This argument is always cloned; to access the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> inside <code>PipeOpLearnerCV</code> by-reference, use <code>$learner</code>.<br /></p></li>
<li><p><code>id</code> :: <code>character(1)</code>
Identifier of the resulting object, internally defaulting to the <code>id</code> of the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> being wrapped.</p></li>
<li><p><code>param_vals</code> :: named <code>list</code><br />
List of hyperparameter settings, overwriting the hyperparameter settings that would otherwise be set during construction. Default <code><a href='https://rdrr.io/r/base/list.html'>list()</a></code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="input-and-output-channels"><a class="anchor" href="#input-and-output-channels"></a>Input and Output Channels</h2>

    

<p><code>PipeOpLearnerCV</code> has one input channel named <code>"input"</code>, taking a <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> specific to the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>
type given to <code>learner</code> during construction; both during training and prediction.</p>
<p><code>PipeOpLearnerCV</code> has one output channel named <code>"output"</code>, producing a <code><a href='https://mlr3.mlr-org.com/reference/Task.html'>Task</a></code> specific to the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>
type given to <code>learner</code> during construction; both during training and prediction.</p>
<p>The output is a task with the same target as the input task, with features replaced by predictions made by the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>.
During training, this prediction is the out-of-sample prediction made by <code><a href='https://mlr3.mlr-org.com/reference/resample.html'>resample</a></code>, during prediction, this is the
ordinary prediction made on the data by a <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> trained on the training phase data.</p>
    <h2 class="hasAnchor" id="state"><a class="anchor" href="#state"></a>State</h2>

    

<p>The <code>$state</code> is set to the <code>$state</code> slot of the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> object, together with the <code>$state</code> elements inherited from the
<code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>. It is a named <code>list</code> with the inherited members, as well as:</p><ul>
<li><p><code>model</code> :: <code>any</code><br />
Model created by the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code>'s <code>$.train()</code> function.</p></li>
<li><p><code>train_log</code> :: <code>data.table</code> with columns <code>class</code> (<code>character</code>), <code>msg</code> (<code>character</code>)<br />
Errors logged during training.</p></li>
<li><p><code>train_time</code> :: <code>numeric(1)</code><br />
Training time, in seconds.</p></li>
<li><p><code>predict_log</code> :: <code>NULL</code> | <code>data.table</code> with columns <code>class</code> (<code>character</code>), <code>msg</code> (<code>character</code>)<br />
Errors logged during prediction.</p></li>
<li><p><code>predict_time</code> :: <code>NULL</code> | <code>numeric(1)</code>
Prediction time, in seconds.</p></li>
</ul>

    <h2 class="hasAnchor" id="parameters"><a class="anchor" href="#parameters"></a>Parameters</h2>

    

<p>The parameters are the parameters inherited from the <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>, as well as the parameters of the <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> wrapped by this object.
Besides that, parameters introduced are:</p><ul>
<li><p><code>resampling.method</code> :: <code>character(1)</code><br />
Which resampling method do we want to use. Currently only supports <code>"cv"</code> and <code>"insample"</code>. <code>"insample"</code> generates
predictions with the model trained on all training data.</p></li>
<li><p><code>resampling.folds</code> :: <code>numeric(1)</code><br />
Number of cross validation folds. Initialized to 3. Only used for <code>resampling.method = "cv"</code>.</p></li>
<li><p><code>keep_response</code> :: <code>logical(1)</code><br />
Only effective during <code>"prob"</code> prediction: Whether to keep response values, if available. Initialized to <code>FALSE</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="internals"><a class="anchor" href="#internals"></a>Internals</h2>

    

<p>The <code>$state</code> is currently not updated by prediction, so the <code>$state$predict_log</code> and <code>$state$predict_time</code> will always be <code>NULL</code>.</p>
    <h2 class="hasAnchor" id="fields"><a class="anchor" href="#fields"></a>Fields</h2>

    

<p>Fields inherited from <code><a href='PipeOp.html'>PipeOp</a></code>, as well as:</p><ul>
<li><p><code>learner</code> :: <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code><br />
<code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> that is being wrapped. Read-only.</p></li>
<li><p><code>learner_model</code> :: <code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code><br />
<code><a href='https://mlr3.mlr-org.com/reference/Learner.html'>Learner</a></code> that is being wrapped. This learner contains the model if the <code>PipeOp</code> is trained. Read-only.</p></li>
</ul>

    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    

<p>Methods inherited from <code><a href='PipeOpTaskPreproc.html'>PipeOpTaskPreproc</a></code>/<code><a href='PipeOp.html'>PipeOp</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>https://mlr3book.mlr-org.com/list-pipeops.html</p>
<p>Other Meta PipeOps: 
<code><a href='mlr_pipeops_learner.html'>mlr_pipeops_learner</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='st'><a href='https://mlr3.mlr-org.com'>"mlr3"</a></span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>task</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>tsk</a></span><span class='op'>(</span><span class='st'>"iris"</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>learner</span> <span class='op'>=</span> <span class='fu'><a href='https://mlr3.mlr-org.com/reference/mlr_sugar.html'>lrn</a></span><span class='op'>(</span><span class='st'>"classif.rpart"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>lrncv_po</span> <span class='op'>=</span> <span class='fu'><a href='po.html'>po</a></span><span class='op'>(</span><span class='st'>"learner_cv"</span>, <span class='va'>learner</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>lrncv_po</span><span class='op'>$</span><span class='va'>learner</span><span class='op'>$</span><span class='va'>predict_type</span> <span class='op'>=</span> <span class='st'>"response"</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>nop</span> <span class='op'>=</span> <span class='va'>mlr_pipeops</span><span class='op'>$</span><span class='fu'>get</span><span class='op'>(</span><span class='st'>"nop"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>graph</span> <span class='op'>=</span> <span class='fu'><a href='gunion.html'>gunion</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span class='r-in'>  <span class='va'>lrncv_po</span>,</span>
<span class='r-in'>  <span class='va'>nop</span></span>
<span class='r-in'><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='concat_graphs.html'>%&gt;&gt;%</a></span> <span class='fu'><a href='po.html'>po</a></span><span class='op'>(</span><span class='st'>"featureunion"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>graph</span><span class='op'>$</span><span class='fu'>train</span><span class='op'>(</span><span class='va'>task</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $featureunion.output</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> &lt;TaskClassif:iris&gt; (150 x 6)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * Target: Species</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * Properties: multiclass</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * Features (5):</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>   - dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>   - fct (1): classif.rpart.response</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>graph</span><span class='op'>$</span><span class='va'>pipeops</span><span class='op'>$</span><span class='va'>classif.rpart</span><span class='op'>$</span><span class='va'>learner</span><span class='op'>$</span><span class='va'>predict_type</span> <span class='op'>=</span> <span class='st'>"prob"</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>graph</span><span class='op'>$</span><span class='fu'>train</span><span class='op'>(</span><span class='va'>task</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $featureunion.output</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> &lt;TaskClassif:iris&gt; (150 x 8)</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * Target: Species</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * Properties: multiclass</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> * Features (7):</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>   - dbl (7): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width,</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>     classif.rpart.prob.setosa, classif.rpart.prob.versicolor,</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>     classif.rpart.prob.virginica</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Martin Binder, Florian Pfisterer, Lennart Schneider, Bernd Bischl, Michel Lang, Susanne Dandl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


