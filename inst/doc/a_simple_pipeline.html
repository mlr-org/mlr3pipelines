<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Florian Pfisterer" />

<meta name="date" content="2019-02-22" />

<title>Showcase: A simple pipeline</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Showcase: A simple pipeline</h1>
<h4 class="author"><em>Florian Pfisterer</em></h4>
<h4 class="date"><em>2019-02-22</em></h4>



<p>This vignette showcases the general syntax and semantic behind <code>mlr3pipelines</code>.</p>
<div id="an-introduction-to-pipeoperators" class="section level2">
<h2>An introduction to PipeOperators</h2>
<p>In this example, we create a Äºinear Pipeline. After scaling all input features, we rotate our data using principal component analysis. After this transformation, we use a simple Decision Tree learner for classification.</p>
<p>As exemplary data, we will use the <code>iris</code> task. This object contains the famous iris dataset and some meta-information, such as the target variable.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">  <span class="kw">library</span>(mlr3)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;iris&quot;</span>)</a></code></pre></div>
<p>We quickly split our data into a train and a test set:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">  test.idx =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(task<span class="op">$</span>nrow), <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  train.idx =<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">seq_len</span>(task<span class="op">$</span>nrow), test.idx)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="co"># Set task to only use train indexes</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  task<span class="op">$</span>row_roles<span class="op">$</span>use =<span class="st"> </span>train.idx</a></code></pre></div>
<p>A Pipeline (or <code>Graph</code>) contains multiple PipeOperators, where each <code>PipeOp</code> transforms the data when it flows through it. For this usecase, we require 3 transformations: - A PipeOp that scales the data - A PipeOp that performs PCA - A PipeOp that contains the <strong>Decision Tree</strong> learner</p>
<p>A list of available PipeOps can be obtained from</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">  <span class="kw">library</span>(mlr3pipelines)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  mlr_pipeops<span class="op">$</span><span class="kw">keys</span>()</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt;  [1] &quot;branch&quot;            &quot;chunk&quot;             &quot;copy&quot;             </span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt;  [4] &quot;encode&quot;            &quot;featureunion&quot;      &quot;filter&quot;           </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;  [7] &quot;learner&quot;           &quot;learner_cv&quot;        &quot;majorityvote&quot;     </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [10] &quot;modelavg&quot;          &quot;nloptmajorityvote&quot; &quot;nloptmodelavg&quot;    </span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; [13] &quot;null&quot;              &quot;pca&quot;               &quot;scale&quot;            </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; [16] &quot;subsample&quot;         &quot;unbranch&quot;          &quot;undersample&quot;</span></a></code></pre></div>
<p>First we define the required PipeOps:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">  op1 =<span class="st"> </span>PipeOpScale<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  op2 =<span class="st"> </span>PipeOpPCA<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  op3 =<span class="st"> </span>PipeOpLearner<span class="op">$</span><span class="kw">new</span>(<span class="dt">learner =</span> mlr_learners<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;classif.rpart&quot;</span>))</a></code></pre></div>
<p>We can quickly visualize what we want to achieve:</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div id="a-quick-glance-into-a-pipeop" class="section level3">
<h3>A quick glance into a PipeOp</h3>
<p>In order to get a better understanding of what the respective PipeOps do, we quickly look at one of them in detail:</p>
<p>The most important slots in a PipeOp are: - <code>train</code>: A function used to train the PipeOp. - <code>predict</code>: A function used to predict with the PipeOp. - <code>id</code>: Set/Get the id of the PipeOp.</p>
<p>The <code>train()</code> and <code>predict()</code> functions define the core functionality of our PipeOp. In many cases, in order to not leak information from the test set into the training set it is imperative to treat train and test data separately. For this we require a <code>train</code> function that learns the appropriate transformations from the training set and a <code>test</code> function that applies the transformation on future data.</p>
<p>In the case of <code>PipeOpPCA</code> this means the following: - <code>train()</code> learns a rotation matrix from its input and saves this matrix to an additional slot, <code>.$state</code>. It returns the rotated input data stored in a new <code>Task</code>. - <code>predict()</code> uses the rotation matrix stored in <code>.$state</code> in order to rotate future, unseen data. It returns those in a new <code>Task</code>.</p>
</div>
</div>
<div id="constructing-the-pipeline" class="section level2">
<h2>Constructing the Pipeline</h2>
<p>We can now connect the <code>PipeOp</code>s constructed earlier to a <strong>Pipeline</strong>. We can do this using the <code>%&gt;&gt;%</code> operator.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">  linear_pipeline =<span class="st"> </span>op1 <span class="op">%&gt;&gt;%</span><span class="st"> </span>op2 <span class="op">%&gt;&gt;%</span><span class="st"> </span>op3</a></code></pre></div>
<p>The result of this operation is a <code>graph</code>. A <code>graph</code> connects the input and output of each <code>PipeOp</code> to the following <code>PipeOp</code>. This allows us to specify linear processing pipelines. In this case, we connect the output of the <strong>scaling</strong> PipeOp to the input of the <strong>PCA</strong> PipeOp and the output of the <strong>PCA</strong> PipeOp to the input of <strong>PipeOpLearner</strong>.</p>
<p>We can now train the <code>graph</code> using the iris <strong>Task</strong>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">  linear_pipeline<span class="op">$</span><span class="kw">train</span>(task)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; $rpart.output</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; NULL</span></a></code></pre></div>
<p>When we now train the graph, the data flows through the graph as follows: - The Task flows into the <code>PipeOpScale</code>. The <code>PipeOp</code> scales each column in the data contained in the Task and returns a new Task that contains the scaled data to its output. Relevant information</p>
<ul>
<li><p>The scaled task flows into the <code>PipeOpPCA</code>. PCA transforms the data and returns a (possibly smaller) Task, that contains the transformed data.</p></li>
<li><p>This transformed data then flows into the learner, in our case <strong>classif.rpart</strong>. It is then used to train the learner, and as a result saves a model that can be used to predict new data.</p></li>
</ul>
<p>In order to predict on new data, we need to save the relevant transformations our data went through while training. As a result, each PipeOp saves a state, where information requried to appropriately transform future data is stored. In our case, this is <strong>mean</strong> and <strong>standard deviation</strong> of each column for <code>PipeOpScale</code>, the PCA rotation matrix for <code>PipeOpPCA</code> and the learned model for <code>PipeOpLearner</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">  <span class="co"># predict on test.idx</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  task<span class="op">$</span>row_roles<span class="op">$</span>use =<span class="st"> </span>test.idx</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  linear_pipeline<span class="op">$</span><span class="kw">predict</span>(task)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; $rpart.output</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; &lt;PredictionClassif&gt; for 30 observations:</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;     row_id  response     truth</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  1:      1    setosa    setosa</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  2:      5    setosa    setosa</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  3:      8    setosa    setosa</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; ---                           </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; 28:    134 virginica virginica</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; 29:    144 virginica virginica</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; 30:    146 virginica virginica</span></a></code></pre></div>
</div>
<div id="using-the-pipeline-as-an-mlr3-learner" class="section level2">
<h2>Using the Pipeline as an mlr3 learner</h2>
<p>In most cases, we want to use the pipeline just like an <strong>mlr3</strong> learner. In order to achieve this, we simply construct a <code>GraphLearner</code> that contains the pipeline we defined.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">  graph_lrn =<span class="st"> </span>GraphLearner<span class="op">$</span><span class="kw">new</span>(linear_pipeline)</a></code></pre></div>
<p>We can now use this learner in order to create an [mlr3::Experiment].</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">  task =<span class="st"> </span>mlr_tasks<span class="op">$</span><span class="kw">get</span>(<span class="st">&quot;iris&quot;</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  e =<span class="st"> </span>Experiment<span class="op">$</span><span class="kw">new</span>(<span class="dt">task =</span> task, <span class="dt">learner =</span> graph_lrn)</a></code></pre></div>
<p>For training:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">  e<span class="op">$</span><span class="kw">train</span>(train.idx)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; INFO [mlr3] Training learner 'scale.pca.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; &lt;Experiment&gt; [trained]:</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;  + Learner: scale.pca.rpart</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;  + Model: [Graph]</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;  - Predictions: [missing]</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  - Performance: [missing]</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; Public: clone(), ctrl, data, has_errors, hash, learner, log(),</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;   model, performance, predict(), prediction, score(), seeds,</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;   state, task, test_set, timings, train_set, train(),</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;   validation_set</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14">  e<span class="op">$</span>model</a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; Graph with 3 PipeOps:</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;     ID                 State sccssors prdcssors</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt;  scale                &lt;list&gt;      pca          </span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt;    pca              &lt;prcomp&gt;    rpart     scale</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt;  rpart &lt;LearnerClassifRpart&gt;                pca</span></a></code></pre></div>
<p>testing:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">  e<span class="op">$</span><span class="kw">predict</span>(test.idx)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">#&gt; INFO [mlr3] Predicting with model of learner 'scale.pca.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; &lt;Experiment&gt; [predicted]:</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt;  + Learner: scale.pca.rpart</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt;  + Model: [Graph]</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;  + Predictions: [PredictionClassif]</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;  - Performance: [missing]</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; Public: clone(), ctrl, data, has_errors, hash, learner, log(),</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;   model, performance, predict(), prediction, score(), seeds,</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;   state, task, test_set, timings, train_set, train(),</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;   validation_set</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  e<span class="op">$</span>prediction</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; &lt;PredictionClassif&gt; for 30 observations:</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt;     row_id  response     truth</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;  1:      1    setosa    setosa</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;  2:      5    setosa    setosa</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt;  3:      8    setosa    setosa</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; ---                           </span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt; 28:    134 virginica virginica</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt; 29:    144 virginica virginica</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt; 30:    146 virginica virginica</span></a></code></pre></div>
<p>and scoring:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">  e<span class="op">$</span><span class="kw">score</span>()</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">#&gt; INFO [mlr3] Scoring predictions of learner 'scale.pca.rpart' on task 'iris' ...</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt; &lt;Experiment&gt; [scored]:</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt;  + Task: iris</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;  + Learner: scale.pca.rpart</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;  + Model: [Graph]</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt;  + Predictions: [PredictionClassif]</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt;  + Performance: classif.mmce=0.1666667</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; Public: clone(), ctrl, data, has_errors, hash, learner, log(),</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;   model, performance, predict(), prediction, score(), seeds,</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;   state, task, test_set, timings, train_set, train(),</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;   validation_set</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  e<span class="op">$</span>performance[<span class="st">&quot;classif.mmce&quot;</span>]</a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; classif.mmce </span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt;    0.1666667</span></a></code></pre></div>
<p>This allows us to seamlessly integrate pipelines with the whole [mlr3] ecosystem, and thus for example resample or benchmark pipelines, tune its params and many more things.</p>
<p>For additional information on <code>mlr3</code> please refer to the respective vignettes.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
